<!DOCTYPE html>
<html lang="en">
<head>
          <title>drewbo.com</title>
        <meta charset="utf-8" />



    <meta name="tags" contents="blog" />
    <meta name="tags" contents="nikeplus" />
    <meta name="tags" contents="running" />
    <meta name="tags" contents="mapbox" />
    <meta name="tags" contents="tutorial" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../../">drewbo.com <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="../../../../../pages/about-me.html">About Me</a></li>
            <li><a href="../../../../../pages/projects.html">Projects</a></li>
            <li><a href="../../../../../pages/theme-info.html">Theme Info</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="../../../../../blog/2014/07/29/nike-plus-running-map/" rel="bookmark"
         title="Permalink to NikePlus Running Map">NikePlus Running Map</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-07-29T11:00:00">
      07 29 2014
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="../../../../../author/drew-bollinger.html">Drew Bollinger</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Inspired by Garrett Miller's (relatively) recent blog post, <a class="reference external" href="https://www.mapbox.com/blog/mapping-moves/">Mapping Moves</a>, I decided to do <a class="reference external" href="http://drewbo.com/blog/2014/05/12/nike-plus-elevation/">something else</a> with all my NikePlus data
and create a map of my runs.
Unfortunately for me, the Nike data is more difficult to liberate than from other sources. Fortunately for me, and anyone else trying
to do this, there are some pre-existing tools to solve this issue.</p>
<p>!END-SUMMARY!</p>
<div id="map" class="map"></div><p class="center"><span class="blue">2012</span> in blue, <span class="orange">2013</span> in orange, <span class="green">2014</span> in green. View <a class="reference external" href="https://a.tiles.mapbox.com/v4/drewbo19.immnjfdh/page.html?access_token=pk.eyJ1IjoiZHJld2JvMTkiLCJhIjoiWlpRb2lYUSJ9.aT3CQyI2_wYzqKPDqjgvyw#13/38.9105/-77.0424">fullscreen</a></p>
<div class="section" id="before-starting">
<h2>Before starting</h2>
<p>Get these things:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.python.org/">Python</a></li>
<li><a class="reference external" href="https://www.mapbox.com/tilemill/">TileMill</a></li>
<li>A <a class="reference external" href="https://www.mapbox.com/">MapBox</a> account</li>
<li><a class="reference external" href="https://github.com/mapbox/togeojson">togeojson</a></li>
</ul>
</div>
<div class="section" id="the-data">
<h2>The data</h2>
<p>First, I used <a class="reference external" href="https://mattstuehler.com/lab/NikePlus/">Matt Stuehler's site</a> (again) to export all of my runs as .gpx files. If you have trouble exporting them all at the same time,
it helps to break them up into 30-40 run groups.</p>
<p>The easiest way to import this data into TileMill is going to be as a .geojson file but it will help if we have our data a little more organized
before converting. I had three years of data so I decided that I would eventually want to style it by year. Here's the folder structure I used:</p>
<img alt="Folder Structure" class="align-center" src="/images/folder-structure.png" style="width: 600px; height: 430px;" />
<p>The Python file in each folder is a slight modification of <a class="reference external" href="https://github.com/kengggg/osm-gpx-download">one used for OpenStreetMap exports</a>. I'm going to post it here because I don't like having to
clone a GitHub repo just to grab one file.:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">output_file_name</span> <span class="o">=</span> <span class="s">&quot;merged.gpx&quot;</span>

<span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#39;</span><span class="p">)</span>
<span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;gpx version=&quot;1.0&quot;&gt;&#39;</span><span class="p">)</span>

<span class="n">gpx_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;*/*.gpx&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">gpx_file_name</span> <span class="ow">in</span> <span class="n">gpx_list</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Parsing &quot;</span><span class="o">+</span><span class="n">gpx_file_name</span><span class="o">+</span><span class="s">&quot; ...&quot;</span>

    <span class="n">fi</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">gpx_file_name</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">gpx_trace</span> <span class="o">=</span> <span class="n">fi</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">fi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">gpx_trace</span><span class="p">)</span>
    <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">trk</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;/gpx&gt;&#39;</span><span class="p">)</span>
<span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>Copy this, save it as gpx-merger.py, and put one in each folder structure like I did above (it needs to be one folder &quot;below&quot; the data
it is aggregating). To run it, navigate to that folder in the command line/terminal and type &quot;python gpx-merger.py&quot;. Sit back and wait.</p>
<img alt="Terminal gif" class="align-center" src="/images/terminal.gif" style="width: 600px; height: 338px;" />
<p>Each time you run it in a new place, it will output a file called 'merged.gpx'.
Now you can pretty much follow the rest of <a class="reference external" href="https://www.mapbox.com/blog/mapping-moves/">Garrett's blog post</a>:</p>
<ul class="simple">
<li>Use togeojson to convert each merged file into a .geojson file</li>
<li>Start a new TileMill project and import each file as a separate layer</li>
<li>Style, then upload to MapBox</li>
</ul>
</div>
<div class="section" id="styling-tips">
<h2>Styling tips</h2>
<ul class="simple">
<li>Bright colors look awesome.</li>
<li>Set the 'line-opacity' attribute to ~0.25. This means that it will take four times over the same path to make the line fully opaque and gives a better idea of how often you run in certain areas.</li>
<li>Use the satellite imagery (requires a basic MapBox account) with a near-black color and saturated filter settings ( &gt;75%).</li>
</ul>
<img alt="filter settings" class="align-center" src="/images/filter-settings.png" style="width: 600px; height: 338px;" />
</div>

  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>
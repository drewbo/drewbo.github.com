<!DOCTYPE html>
<html lang="en">
<head>
          <title>drewbo.com</title>
        <meta charset="utf-8" />



    <meta name="tags" contents="r" />
    <meta name="tags" contents="blog" />
    <meta name="tags" contents="nikeplus" />
    <meta name="tags" contents="running" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../../">drewbo.com <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="../../../../../pages/about-me.html">About Me</a></li>
            <li><a href="../../../../../pages/projects.html">Projects</a></li>
            <li><a href="../../../../../pages/theme-info.html">Theme Info</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="../../../../../blog/2014/05/12/nike-plus-elevation/" rel="bookmark"
         title="Permalink to NikePlus Elevation Tracker">NikePlus Elevation Tracker</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-05-12T23:30:00">
      05 12 2014
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="../../../../../author/drew-bollinger.html">Drew Bollinger</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>I'm taking a quick break from my KenPom data visualization work this week (though I have made some updates; work in progress on the <a class="reference external" href="../../../../../pages/projects.html">projects</a> page) to talk about
another project I've been working on. I'm an avid runner and have an upcoming race where I'm a little worried about the elevation changes so I thought bringing in
some programming could help.</p>
<p>!END-SUMMARY!</p>
<p>The <a class="reference external" href="https://secure-nikeplus.nike.com/plus/">NikePlus</a> app that I use to track my runs does show changes in pace and elevation (see chart below) but it doesn't give you any idea of the total change in
elevation for the whole run. Most people do &quot;point-to-point&quot; runs so the net change is zero but there is still a big difference between 100 feet up then down
and 1,000 feet up then down over the course of a run.</p>
<img alt="NikePlus Pace and Elevation Chart" class="align-center" src="/images/NikePlus-1-20-2013.png" style="width: 800px; height: 90px;" />
<p>So, I decided to figure out how to calculate this on my own. I first used the <a class="reference external" href="https://mattstuehler.com/lab/NikePlus/">this site</a> by Matt Stuehler to export my data from NikePlus as .gpx files. Then I wrote
a small function in R to sum all of the changes in elevation throughout the whole run <a class="footnote-reference" href="#id2" id="id1">[1]</a> . I'd like to eventually convert this to a standalone Python executable but for
now, here's the code.</p>
<div class="highlight"><pre>elevationstats <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>month<span class="p">,</span>day<span class="p">,</span>res<span class="o">=</span><span class="m">1</span><span class="p">){</span>

<span class="c1">## get the file and turn it into a numeric vector</span>

setwd<span class="p">(</span><span class="s">&quot;[folder where the file is]&quot;</span><span class="p">)</span>
filename <span class="o">&lt;-</span> paste<span class="p">(</span><span class="s">&quot;[username]_[year]_&quot;</span><span class="p">,</span>month<span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">,</span>day<span class="p">,</span><span class="s">&quot;.gpx&quot;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
fullfile <span class="o">&lt;-</span> read.csv<span class="p">(</span>filename<span class="p">,</span>header<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
r <span class="o">&lt;-</span> gregexpr<span class="p">(</span><span class="s">&quot;&lt;ele&gt;.*?&lt;/ele&gt;&quot;</span><span class="p">,</span>as.character<span class="p">(</span>fullfile<span class="p">[[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]]))</span>
x <span class="o">&lt;-</span> regmatches<span class="p">(</span>as.character<span class="p">(</span>fullfile<span class="p">[[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]]),</span>r<span class="p">)</span>
elevation_list <span class="o">&lt;-</span> as.numeric<span class="p">(</span>gsub<span class="p">(</span><span class="s">&quot;&lt;ele&gt;|&lt;/ele&gt;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span>x<span class="p">[[</span><span class="m">1</span><span class="p">]]))</span>

<span class="c1">## change resolution</span>
new_ele <span class="o">&lt;-</span> elevation_list<span class="p">[</span>c<span class="p">(</span>rep<span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span>res<span class="m">-1</span><span class="p">),</span><span class="kc">TRUE</span><span class="p">)]</span>

<span class="c1">## calculate the total elevation gain and loss</span>

total_gain <span class="o">&lt;-</span> sum<span class="p">(</span>diff<span class="p">(</span>new_ele<span class="p">)[</span>diff<span class="p">(</span>new_ele<span class="p">)</span><span class="o">&gt;</span><span class="m">0</span><span class="p">])</span>
total_loss <span class="o">&lt;-</span> sum<span class="p">(</span>diff<span class="p">(</span>new_ele<span class="p">)[</span>diff<span class="p">(</span>new_ele<span class="p">)</span><span class="o">&lt;</span><span class="m">0</span><span class="p">])</span>

c<span class="p">(</span>total_gain<span class="p">,</span>total_loss<span class="p">,</span>length<span class="p">(</span>new_ele<span class="p">))</span>

<span class="p">}</span>
</pre></div>
<p>Here's what that code does:</p>
<ul class="simple">
<li>Opens the specified file and pulls out the relevant data using some regular expressions.</li>
<li>Sets the &quot;resolution&quot; (you might not want to use every point if you think measuring elevation differences every ~10 feet is too much detail)</li>
<li>Calculates the total elevation gain and loss by summing up the differences between each point. It uses two variables to keep track of positive and negative differences separately.</li>
<li>Outputs the total elevation gain, total elevation loss, and number of GPS points used to the R console.</li>
</ul>
<p>I ran this code on the run pictured above with resolution = 1 (a GPS point every ~10.9 feet over 9 miles) and got the results:</p>
<div class="highlight"><pre><span class="p">[</span><span class="m">381</span> meters up<span class="p">,</span> <span class="m">349</span> meters down<span class="p">,</span> <span class="m">4377</span> points<span class="p">]</span>
</pre></div>
<p>Running it again with resolution = 10 (a GPS points every ~109 feet) gave:</p>
<div class="highlight"><pre><span class="p">[</span><span class="m">295</span> meters up<span class="p">,</span> <span class="m">262</span> meters down<span class="p">,</span> <span class="m">437</span> points<span class="p">]</span>
</pre></div>
<p>The truth is probably somewhere in between, especially given the variability of GPS data.</p>
<p>If you're a runner who uses NikePlus and is proficient in R, let me know if this is helpful. Hopefully I can put out a more user-friendly version
in the next few weeks. Happy Trails!</p>
<div class="separator container">
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>I'm just now realizing how incredibly similar this is to my KenPom drama metric. My roommate said that he realized this all along when I was talking about it and I'm an idiot.</td></tr>
</tbody>
</table>

  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>